#!/bin/bash
explain=0
simple=0
lessc=0
# Functions for arguments
function help_f (){
    printf "Aioi, one command for all linux system info\n"
    printf "        Usage:\n"
    printf "        help | -h | --help : show help message\n"
    printf "        ram : show ram informations, usage\n"
    printf "        cpu : show cpu informations, usage\n"   
    printf "        gpu : show gpu informations, usage\n"
   
    printf "\n"
    printf "        additional arguments, passed after the first argument:\n"
    printf "        -e : explain from there this command has this information, show the original command\n"
    printf "        -s : Make the output simpler and beautiful\n"
    printf "        -l : use the less command to not litter your terminal\n"

return 0
}
function screen_f () {
    if [[ "$explain" == "0" ]];then
        printf "Show Monitor informations:\n"
        if [[ "$explain" == "3" ]];then
            :
            elif ! command -v parse-edid &> /dev/null ;then
                printf "parse-edid command not found, install the package for it\n"
            else
            ls /sys/class/drm/*/edid | xargs -i{} sh -c "echo {}; parse-edid < {}"
        fi
    fi
    if [[ "$explain" == "1" ]];then
        printf "Used command:\n"
        printf 'ls /sys/class/drm/*/edid | xargs -i{} sh -c "echo {}; parse-edid < {}\n'
        printf "Other possibly usefull commands for screen informations:\n"
        printf 'grep -i "monitor name" /var/log/syslog\n'
        printf "cat /sys/class/drm/card0-eDP-1/edid | edid-decode\n"
        printf "xrandr --prop\n"
        printf "xrandr --verbose\n"
        printf "lshw -c display\n"
    fi
return 0
}
function gpu_f () {
    if [[ "$explain" == "1" ]];then
        printf "Used information commands:\n"
        printf "lspci | grep ' VGA ' | cut -d\" \" -f 1 | xargs -i lspci -v -k -s {}\n"
        printf "glxinfo -B\n"
        printf "Other information commands:\n"
        printf "sudo lshw -numeric -C display\n"
        printf "inxi -G\n"
        printf "All usage commands:\n"
        printf "For nvidia cards:\n"
        printf "nvidia-smi\n"
        printf "nvtop\n"
        printf "For radeon cards:\n"
        printf "radeontop\n"
        printf "aticonfig --odgc --odgt\n"
        printf "For intel cards:\n"
        printf "sudo intel_gpu_top\n"
        printf "intel_gpu_time (Launch a application)\n"
        printf "Benchmark / stress command:\n"
        printf "glxgears\n"
    fi
    if [[ "$explain" == "0" ]];then
        printf "GPU informations:\n"
        lspci | grep ' VGA ' | cut -d" " -f 1 | xargs -i lspci -v -k -s {}
        printf "Opengl and mesa informations:\n"
        if [[ "$explain" == "3" ]];then
        :
        elif ! command -v glxinfo &> /dev/null ;then
            printf "glxinfo command not found, install the package for it\n"
        else
            glxinfo -B
        fi
        printf "Specific GPU usage commands:\n"
        gpuinfo=$(lspci | grep ' VGA ' | cut -d" " -f 1 | xargs -i lspci -v -k -s {})
        yesnvidia=$(echo $gpuinfo | grep -oih 'nvidia')
        yesamd=$(echo $gpuinfo | grep -oih 'amd')
        yesamd=$(echo $gpuinfo | grep -oih 'ati')
        yesintel=$(echo $gpuinfo | grep -oih 'intel')
        if [[ -z ${yesnvidia} ]];then
            :
        else
            printf "For nvidia cards:\n"
            printf "nvidia-smi\n"
            printf "nvtop\n"
        fi
        if [[ -z ${yesnamd} ]];then
            :
        else
            if [[ -z ${yesnvidia} ]];then
                printf "\n"
            fi
            printf "For radeon cards:\n"
            printf "radeontop\n"
            printf "aticonfig --odgc --odgt\n"
        fi
        if [[ -z ${yesintel} ]];then
            :
        else
            if [[ -z ${yesnvidia} ]];then
                :
            else
                printf "\n"
            fi
            printf "For intel cards:\n"
            printf "sudo intel_gpu_top\n"
            printf "intel_gpu_time (Launch a application)\n"
        fi
    fi
return 0
}
function cpu_f () {
    if [[ "$explain" == "0" ]];then
    printf "To show cpu usage use the htop command\n"
    printf "To show informations about the usage, use the the mpstat –P ALL command\n"
    printf "How to read the mpstat command:\n"
    printf "\n"
    printf "usr –  cpu usage at the user level
nice –  cpu usage for user processes labeled “nice”
sys –  cpu usage at the system (Linux kernel) level
iowait –  cpu usage idling waiting on a disk read/write
irq –  cpu usage handling hardware interrupts
soft –  cpu usage handing software interrupts
steal –  cpu usage being forced to wait for a hypervisor handling other virtual processors
guest –  cpu usage spent running a virtual processor
idle –  cpu usage on idle time (no processes, and not waiting on a disk read/write)\n"
    printf "\n"
    printf "CPU informations:\n"
    lscpu
    fi
    if [[ "$explain" == "1" ]];then
    printf "Used information command:\n"
    printf "lscpu\n"
    printf "More commands for more informations:\n"
    printf "cat /proc/cpuinfo\n"
    printf "dmidecode --type processor\n"
    printf "inxi -C\n"
    printf "lshw -class processor\n"
    printf "benchmark / stress command:\n"
    printf "stress --cpu $(nproc)\n"
    fi
return 0
}

function ram_f () {
    if [[ "$explain" == "1" ]];then
        printf "RAM usage command:\n"
        printf "free -h -w\n"
        printf "for RAM informations:\n" 
        printf "RAM usage:\n"
        printf "dmidecode --type memory\n"
        fi
    if [[ "$explain" == "0" ]];then
        free -h -w
        printf 'More specific informations about usage are avaible under "less /proc/meminfo" command'
        printf "\n"  
        printf "\n"    
        printf "RAM informations:"
        printf "\n"  
        if [ "$EUID" -ne 0 ];then 
            printf "Please run as root to get this informations"
            exit
        elif  ! command -v dmidecode &> /dev/null;then
            echo "dmidecode command could not be found, install the package for it"
            exit
        else
            dmidecode --type memory
            exit
        fi
    fi
    return 0
}
if [[ -z ${1} ]];then
        help_f
fi
if [[ "$2" == "-e" ]];then
        explain=1
elif [[ "$2" == "-s" ]];then
        simple=1
elif  [[ "$2" == "-l" ]];then
        lessc=1
fi

if [[ "$3" == "-e" ]];then
    explain=1
elif [[ "$3" == "-s" ]];then
    simple=1
elif  [[ "$3" == "-l" ]];then
        lessc=1
fi
while  [ ! -z "$1" ]; do
    if [[ "$1" == "help" ]] || [[ "$1" == "-h" ]] || [[ "$1" == "--help" ]];then
        if [[ "$lessc" == "1" ]];then
            help_f | less
        else
            help_f
        fi
    elif [[ "$1" == "ram" ]];then
        if [[ "$lessc" == "1" ]];then
            ram_f | less
        else
            ram_f
        fi
    elif [[ "$1" == "cpu" ]];then
        if [[ "$lessc" == "1" ]];then
            cpu_f | less
        else
            cpu_f
        fi    
    elif [[ "$1" == "gpu" ]];then
        if [[ "$lessc" == "1" ]];then
            gpu_f | less
        else
            gpu_f
        fi    
    elif [[ "$1" == "screen" ]];then
        if [[ "$lessc" == "1" ]];then
            screen_f | less
        else
            screen_f
        fi    
















    fi
shift
done

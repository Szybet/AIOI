#!/bin/bash
explain=0
simple=0
lessc=0
# Functions for arguments
function help_f (){
    printf "Aioi, one command for all linux system info\n"
    printf "        Usage:\n"
    printf "        help | -h | --help : show help message\n"
    printf "        ram : show ram informations, usage\n"
    printf "        cpu : show cpu informations, usage\n"   
    printf "        gpu : show gpu informations, usage\n"
    printf "        network : show network informations\n"
    printf "        screen : show screen informations\n"
    printf "        disks : show disks informations\n"
   
    printf "\n"
    printf "        additional arguments, passed after the first argument:\n"
    printf "        -e : explain from there this command has this information, show the original command\n"
    printf "        -s : Make the output simpler and beautiful\n"
    printf "        -l : use the less command to not litter your terminal\n"

return 0
}
function disks_f () {
    if [[ "$explain" == "1" ]];then
        printf "used commands\n"
        printf "lsblk --output NAME,SIZE,FSUSED,TYPE,MOUNTPOINT,FSTYPE\n"
        printf "lsblk --output NAME,UUID\n"
        printf "lsblk --output NAME,LABEL,PARTLABEL,PARTFLAGS\n"
        printf "sudo hdparm -I /dev/sda\n"
        printf "lshw -class disk -class storage\n"
        printf "lshw -short -C disk\n"
        printf "sudo iostat --pretty --human\n"
        printf "Disk health command ( smartctl )\n"
        printf "check support for smartcl for a disk:\n"
        printf "smartctl -i /dev/sda\n"
        printf "to make tests:\n"
        printf "smartctl --test=short /dev/sda\n"
        printf "or smartctl --test=long /dev/sda\n"
        printf "to get the output of the test:\n"
        printf "smartctl -a /dev/sda\n"
        printf "For checking badblocks:\n"
        printf "badblocks -nvs /dev/sdx\n"
        printf "Other helpful commands:\n"
        printf "cat /etc/fstab\n"
        printf "fdisk -l\n"
        printf "iotop -o\n"
        printf "ioping /dev/sdx\n"
        printf "Benchmarking:\n"
        printf "sudo hdparm -tT /dev/sdx\n"
        printf "dd if=/dev/zero of=benchfile bs=4k count=200000 && sync; rm benchfile\n"
        printf "dd if=/dev/zero of=/dev/null && sync\n"
    fi
    if [[ "$explain" == "0" ]];then
                printf "Show information about the partitions\n"
                lsblk --output NAME,SIZE,FSUSED,TYPE,MOUNTPOINT,FSTYPE
                printf "\n"
                printf "Show partitions UUID\n"
                lsblk --output NAME,UUID
                printf "\n"
                printf "Show partition label and flags\n"
                lsblk --output NAME,LABEL,PARTLABEL,PARTFLAGS
                printf "\n"
                if [ "$EUID" -ne 0 ];then 
                printf "To show disk informations, please run as root\n"
                else
                    if [[ "$explain" == "3" ]];then
                        :
                    elif ! command -v lshw &> /dev/null ;then
                        printf "command lshw not found, using other commands, for better informations install the package\n"
                        if [[ "$explain" == "3" ]];then
                            :
                        elif ! command -v lshw &> /dev/null ;then
                            printf "command hdparm not found, using other commands, for better informations install the package\n"
                        else
                            sudo hdparm -I /dev/sda
                        fi
                    else
                        printf "Show disk informations\n"
                        lshw -class disk -class storage
                        printf "\n"
                        printf "Show simple disk names\n"
                        lshw -short -C disk
                    fi
                printf "\n"
                printf "Show disk read writes in real time\n"
                if [[ "$explain" == "3" ]];then
                        :
                    elif ! command -v iostat &> /dev/null ;then
                        printf "command iostat not found, install the iotop package\n"
                    else
                        sudo iostat --pretty --human
                fi
            printf "For disk health, look at the -e argument\n"
        fi
    fi
return 0
}
function network_f () {
    if [[ "$explain" == "0" ]];then
        printf "Network interfaces informations:\n"
        if [[ "$explain" == "3" ]];then
            :
            elif ! command -v ifconfig &> /dev/null ;then
                printf "command ifconfig not found, using other commands, for better informations install the package\n"
                ip a
            else
                ifconfig
            fi
            printf "show setted DNS servers:\n"
            grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}' /etc/resolv.conf
            printf "Single test whot DNS server will be used:\n"
            dig duckduckgo.com | grep SERVER | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}' | head -1
            printf "\n"
            printf "NTP status, systemd based:\n"
            timedatectl status
            printf "used NTP servers, systemd based:\n"
            cat /etc/systemd/timesyncd.conf | grep org
            printf "Full config at /etc/systemd/timesyncd.conf\n"
            if [[ "$explain" == "3" ]];then
                :
            elif ! command -v ntpq &> /dev/null ;then
                :
            else
                printf "NTP status, ntpq command\n"
                ntpq -pn
            fi
            printf "\n"
            printf "Show ARP table:\n"
            arp -e
            printf "\n"
            printf "dhcp info:\n"
            systemctl status dhcpcd
            cat /var/lib/dhcp/dhclient.leases
            printf "\n"
            printf "Show routes\n"
            ip route
            printf "\n"
            printf "Show open ports:\n"
            lsof -i
            if [ "$EUID" -ne 0 ];then 
                printf "Running as root will show open ports by other users\n"
            else
                :
            fi
    fi
    if [[ "$explain" == "1" ]];then
        printf "Used commands:\n"
        printf "ip a\n"
        printf "ifconfig\n"
        printf "grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}' /etc/resolv.conf\n"
        printf "dig duckduckgo.com | grep SERVER | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}' | head -1\n"
        printf "timedatectl status\n"
        printf "cat /etc/systemd/timesyncd.conf | grep org\n"
        printf "ntpq -pn\n"
        printf "arp -e\n"
        printf "systemctl status dhcpcd\n"
        printf "cat /var/lib/dhcp/dhclient.leases\n"
        printf "ip route\n"
        printf "lsof -i\n"
        printf "Other usefull commands:\n"
        printf "systemctl status NetworkManager\n"
        printf "netstat -rn\n"
        printf "ntpstat\n"
    fi
return 0
}

function screen_f () {
    if [[ "$explain" == "0" ]];then
        printf "Show Monitor informations:\n"
        if [[ "$explain" == "3" ]];then
                :
            elif ! command -v parse-edid &> /dev/null ;then
                printf "parse-edid command not found, install the package for it\n"
            else
                ls /sys/class/drm/*/edid | xargs -i{} sh -c "echo {}; parse-edid < {}"
        fi
    fi
    if [[ "$explain" == "1" ]];then
        printf "Used command:\n"
        printf 'ls /sys/class/drm/*/edid | xargs -i{} sh -c "echo {}; parse-edid < {}\n'
        printf "Other possibly usefull commands for screen informations:\n"
        printf 'grep -i "monitor name" /var/log/syslog\n'
        printf "cat /sys/class/drm/card0-eDP-1/edid | edid-decode\n"
        printf "xrandr --prop\n"
        printf "xrandr --verbose\n"
        printf "lshw -c display\n"
    fi
return 0
}

function gpu_f () {
    if [[ "$explain" == "1" ]];then
        printf "Used information commands:\n"
        printf "lspci | grep ' VGA ' | cut -d\" \" -f 1 | xargs -i lspci -v -k -s {}\n"
        printf "glxinfo -B\n"
        printf "Other information commands:\n"
        printf "sudo lshw -numeric -C display\n"
        printf "inxi -G\n"
        printf "All usage commands:\n"
        printf "For nvidia cards:\n"
        printf "nvidia-smi\n"
        printf "nvtop\n"
        printf "For radeon cards:\n"
        printf "radeontop\n"
        printf "aticonfig --odgc --odgt\n"
        printf "For intel cards:\n"
        printf "sudo intel_gpu_top\n"
        printf "intel_gpu_time (Launch a application)\n"
        printf "Benchmark / stress command:\n"
        printf "glxgears\n"
    fi
    if [[ "$explain" == "0" ]];then
        printf "GPU informations:\n"
        lspci | grep ' VGA ' | cut -d" " -f 1 | xargs -i lspci -v -k -s {}
        printf "Opengl and mesa informations:\n"
        if [[ "$explain" == "3" ]];then
        :
        elif ! command -v glxinfo &> /dev/null ;then
            printf "glxinfo command not found, install the package for it\n"
        else
            glxinfo -B
        fi
        printf "Specific GPU usage commands:\n"
        gpuinfo=$(lspci | grep ' VGA ' | cut -d" " -f 1 | xargs -i lspci -v -k -s {})
        yesnvidia=$(echo $gpuinfo | grep -oih 'nvidia')
        yesamd=$(echo $gpuinfo | grep -oih 'amd')
        yesamd=$(echo $gpuinfo | grep -oih 'ati')
        yesintel=$(echo $gpuinfo | grep -oih 'intel')
        if [[ -z ${yesnvidia} ]];then
            :
        else
            printf "For nvidia cards:\n"
            printf "nvidia-smi\n"
            printf "nvtop\n"
        fi
        if [[ -z ${yesnamd} ]];then
            :
        else
            if [[ -z ${yesnvidia} ]];then
                printf "\n"
            fi
            printf "For radeon cards:\n"
            printf "radeontop\n"
            printf "aticonfig --odgc --odgt\n"
        fi
        if [[ -z ${yesintel} ]];then
            :
        else
            if [[ -z ${yesnvidia} ]];then
                :
            else
                printf "\n"
            fi
            printf "For intel cards:\n"
            printf "sudo intel_gpu_top\n"
            printf "intel_gpu_time (Launch a application)\n"
        fi
    fi
return 0
}
function cpu_f () {
    if [[ "$explain" == "0" ]];then
    printf "To show cpu usage use the htop command\n"
    printf "To show informations about the usage, use the the mpstat –P ALL command\n"
    printf "How to read the mpstat command:\n"
    printf "\n"
    printf "usr –  cpu usage at the user level
nice –  cpu usage for user processes labeled “nice”
sys –  cpu usage at the system (Linux kernel) level
iowait –  cpu usage idling waiting on a disk read/write
irq –  cpu usage handling hardware interrupts
soft –  cpu usage handing software interrupts
steal –  cpu usage being forced to wait for a hypervisor handling other virtual processors
guest –  cpu usage spent running a virtual processor
idle –  cpu usage on idle time (no processes, and not waiting on a disk read/write)\n"
    printf "\n"
    printf "CPU informations:\n"
    lscpu
    fi
    if [[ "$explain" == "1" ]];then
    printf "Used information command:\n"
    printf "lscpu\n"
    printf "More commands for more informations:\n"
    printf "cat /proc/cpuinfo\n"
    printf "dmidecode --type processor\n"
    printf "inxi -C\n"
    printf "lshw -class processor\n"
    printf "benchmark / stress command:\n"
    printf "stress --cpu $(nproc)\n"
    fi
return 0
}

function ram_f () {
    if [[ "$explain" == "1" ]];then
        printf "RAM usage command:\n"
        printf "free -h -w\n"
        printf "for RAM informations:\n" 
        printf "RAM usage:\n"
        printf "dmidecode --type memory\n"
        printf "cat /proc/sys/vm/swappiness\n"
        fi
    if [[ "$explain" == "0" ]];then
        free -h -w
        printf 'More specific informations about usage are avaible under "less /proc/meminfo" command'
        printf "\n"  
        printf "\n"    
        printf "RAM informations:"
        printf "\n"  
        if [ "$EUID" -ne 0 ];then 
            printf "Please run as root to get this informations"
        elif  ! command -v dmidecode &> /dev/null;then
            echo "dmidecode command could not be found, install the package for it\n"
        else
            dmidecode --type memory
        fi
        printf "\n"
        printf "\n"
        printf "Setted swappiness:\n"
        cat /proc/sys/vm/swappiness
    fi
    return 0
}
if [[ -z ${1} ]];then
        help_f
fi
if [[ "$2" == "-e" ]];then
        explain=1
elif [[ "$2" == "-s" ]];then
        simple=1
elif  [[ "$2" == "-l" ]];then
        lessc=1
fi

if [[ "$3" == "-e" ]];then
    explain=1
elif [[ "$3" == "-s" ]];then
    simple=1
elif  [[ "$3" == "-l" ]];then
        lessc=1
fi
while  [ ! -z "$1" ]; do
    if [[ "$1" == "help" ]] || [[ "$1" == "-h" ]] || [[ "$1" == "--help" ]];then
        if [[ "$lessc" == "1" ]];then
            help_f | less
        else
            help_f
        fi
    elif [[ "$1" == "ram" ]];then
        if [[ "$lessc" == "1" ]];then
            ram_f | less
        else
            ram_f
        fi
    elif [[ "$1" == "cpu" ]];then
        if [[ "$lessc" == "1" ]];then
            cpu_f | less
        else
            cpu_f
        fi    
    elif [[ "$1" == "gpu" ]];then
        if [[ "$lessc" == "1" ]];then
            gpu_f | less
        else
            gpu_f
        fi    
    elif [[ "$1" == "screen" ]];then
        if [[ "$lessc" == "1" ]];then
            screen_f | less
        else
            screen_f
        fi    
    elif [[ "$1" == "network" ]];then
        if [[ "$lessc" == "1" ]];then
            network_f | less
        else
            network_f
        fi    
    elif [[ "$1" == "disks" ]];then
        if [[ "$lessc" == "1" ]];then
           disks_f | less
        else
            disks_f
        fi    
















    fi
shift
done
